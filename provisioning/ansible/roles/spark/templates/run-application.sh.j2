#!/bin/bash

if [ -z "$1" ] 
then
    echo "You must specify the application with arguments"
    exit 1;
fi
APPLICATION=$@
MODULESDIR=$(dirname "${APPLICATION}")/modules

# Output colors
GREEN='\033[0;32m'
NC='\033[0m' # No Color
PYFILES=''

if [ -d $MODULESDIR ]
then
    echo -e "${GREEN}[info] Creating zip with all modules${NC}"
    zip -r modules{.zip,}
    $PYFILES = " --py-files modules.zip"
fi


echo -e "${GREEN}[info] Running application $APPLICATION...${NC}"

export SPARK_MASTER_HOST=10.16.31.210
export SPARK_LOCAL_IP=10.16.31.210
/opt/spark/spark-bin/bin/spark-submit --master spark://10.16.31.210:7077 --conf spark.eventLog.enabled=false --conf spark.eventLog.dir="/opt/spark/spark-bin/logs/" --conf spark.executor.logs.rolling.maxRetainedFiles=3 --conf spark.executor.logs.rolling.maxSize=1G --conf spark.executor.logs.rolling.strategy=size --total-executor-cores 8 --executor-memory 4G --jars "../spark-streaming-kafka-assembly.jar"$PYFILES /home/spark/applications/$APPLICATION
